!function(){function e(){$("#mainLeft").find(".reply-html").remove();var e=$(this),t=$(k.html()),a=e.attr("data-replyid");e.parent().parent().parent().after(t),j=new Vue({el:".reply-html",data:{message:""}}),$(".btn-canel").click(function(){$(this).parent().remove()}),$(".btn-yes").click(function(){var t=$(this).parent(),n=t.find("textarea");""==n.val()?alert("你没写内容呐，怎么发布呢？赶紧说两句儿吧～"):$.ajax({url:"/comment/commentArticle.html",type:"post",data:{userid:v.val(),articleid:m.val(),content:n.val(),replyid:a},dataType:"json",success:function(a){1==a.result&&(t.remove(),r(1),e.next().text("("+(parseInt(e.next().text().replace(/[^0-9]/g,""))+1)+")"),x.text(parseInt(x.text())+1))}})})}function t(){if(k.html()){var t=$(".reply-btn");t.unbind("click",e),t.bind("click",e)}}function a(){var e=$(this);console.log(e[0]),$.ajax({url:"/comment/supportComment.html",type:"post",data:{id:e.attr("data-replyid")},dataType:"json",success:function(t){1==t.result&&e.next().text("("+(parseInt(e.next().text().replace(/[^0-9]/g,""))+1)+")")}})}function n(){var e=$(".support-btn");e.unbind("click",a),e.bind("click",a)}function r(e){$.ajax({url:"/comment/commentList.html",type:"post",data:{articleid:m.val(),currentPage:e},dataType:"json",success:function(e){if(1==e.result&&e.list.length>0){for(var a=e.list,r=e.page,l="",c=0;c<a.length;c++)l+='<dl class="comment-li"><a href="" class="headimg"><img src="../'+a[c].headimg+'" alt="'+a[c].username+'"></a><h1><a href="">'+a[c].username+"</a>"+a[c].addtime+"</h1><p>"+a[c].content+'</p><h2><a href="javascript:void(0)" class="support-btn" data-replyid="'+a[c].id+'">支持</a><i>('+a[c].supports+')</i><span><a href="javascript:void(0)" class="reply-btn" data-replyid="'+a[c].id+'">回复</a><i>('+a[c].replys+")</i></span></h2></dl>";if(I.html(l),t(),n(),r.pages>1){var s="";T.show();for(var c=1;c<=r.pages;c++)r.currentPage==c?s+='<li class="current"><a href="javascript:void(0)">'+c+"</a></li>":s+='<li><a href="javascript:void(0)">'+c+"</a></li>";w.html(s),T.attr("data-current",r.currentPage),A.val(r.currentPage),P.text(r.pages),i()}else T.hide()}}})}function i(){w.find("li a").click(function(){r($(this).text())})}var l=document.getElementById("hideArticle"),c=document.createElement("article"),s=document.getElementById("contentInfo");c.innerHTML=l.value;for(var o=c.getElementsByTagName("pre"),d=0,p=o.length;d<p;d++){var u=document.createTextNode(o[d].innerHTML);o[d].innerHTML="",o[d].appendChild(u)}s.getElementsByTagName("article")[0].innerHTML=c.innerHTML,s.removeChild(l);var m=$("#articleId"),v=$("#userId"),f=new Vue({el:"#likes",data:{isActive:!1,likes:0},methods:{click:function(){v.val()?f.isActive||MjAjax.ajax({url:"/article/likeArticle.html",type:"post",data:{articleid:m.val(),userid:v.val()},dataType:"json",success:function(e){1==e.result?(f.isActive=!0,f.likes++,MjDialog.like()):alert(e.message)}}):window.location.href="/user/login.html?redirection="+window.location.href.replace(/\?/g,"%3F").replace(/&/g,"%26")}}}),g=new Vue({el:"#collections",data:{isActive:!1,collections:0},methods:{click:function(){v.val()?g.isActive||MjAjax.ajax({url:"/article/collectionArticle.html",type:"post",data:{articleid:m.val(),userid:v.val()},dataType:"json",success:function(e){1==e.result?(alert(e.message),g.isActive=!0,g.collections++):alert(e.message)}}):window.location.href="/user/login.html?redirection="+window.location.href.replace(/\?/g,"%3F").replace(/&/g,"%26")}}}),h=$("#commentBtn"),y=$("#commandContent"),x=$("#articleCom").find("b");if(h.click(function(){""==y.val()?alert("你没写内容呐，怎么发布呢？赶紧说两句儿吧～"):$.ajax({url:"/comment/commentArticle.html",type:"post",data:{userid:v.val(),articleid:m.val(),content:y.val(),replyid:0},dataType:"json",success:function(e){1==e.result&&(r(1),x.text(parseInt(x.text())+1))}})}),$("#loginCom").length>0){new Vue({el:"#loginCom",data:{content:""},methods:{comment:function(){""==this.content?alert("你没写内容呐，怎么发布呢？赶紧说两句儿吧～"):$.ajax({url:"/comment/commentArticle.html",type:"post",data:{userid:v.val(),articleid:m.val(),content:this.content,replyid:0},dataType:"json",success:function(e){1==e.result&&(r(1),x.text(parseInt(x.text())+1),alert("评论成功"))}})}}})}var j,k=$("#replyHtml");t(),n();var I=$("#commentList"),T=$("#page"),w=$("#pages"),A=$("#currentPage"),P=$("#pagesNum"),b=$("#firstPage"),C=$("#prevPage"),L=$("#nextPage"),M=$("#lastPage");r(1),b.click(function(){r(1)}),C.click(function(){parseInt(T.attr("currentPage"))>1&&r(parseInt(T.attr("currentPage"))-1)}),L.click(function(){parseInt(T.attr("currentPage"))<parseInt(P.text())&&r(parseInt(T.attr("currentPage"))+1)}),M.click(function(){r(parseInt(P.text()))}),A.bind("input",function(){A.val(A.val().replace(/[^0-9]/g,"")),parseInt(A.val())>parseInt(P.text())?A.val(P.text()):parseInt(A.val())<1&&A.val(1)}),A.blur(function(){""==A.val()&&A.val(T.attr("currentPage"))}),A.keydown(function(e){13==e.keyCode&&""!=A.val()&&r(parseInt(A.val()))})}();